<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyze OpenAI Models</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold mb-8 text-center text-gray-800">Analyze OpenAI Models</h1>
		<!-- Footer -->
		<footer class="bg-gray-800 text-white py-4 mt-8">
			<div class="container mx-auto px-4">
				<div class="flex flex-col md:flex-row justify-between items-center">
					<div class="mb-4 md:mb-0">
						<p class="text-sm">Student name: Sandeep Nalla</p>
						<p class="text-sm">Email: 21f1006125@ds.study.iitm.ac.in</p>
					</div>
					<div class="text-sm text-center md:text-right">
						<p>Created using Claude AI</p>
					</div>
				</div>
			</div>
		</footer>
        <div class="flex flex-col md:flex-row gap-8">
            <!-- Left Pane -->
            <div class="w-full md:w-1/2 bg-white rounded-lg shadow-md p-6">
                <div class="mb-4">
                    <label for="apiToken" class="block text-sm font-medium text-gray-700 mb-2">AI Proxy Token:</label>
                    <input type="password" id="apiToken" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="">
                </div>
                <div class="mb-4">
                    <label for="question" class="block text-sm font-medium text-gray-700 mb-2">Question:</label>
                    <textarea id="question" rows="6" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">4 points if gpt-3.5-turbo-0125 was created on 2024-01-23
2 points if text-embedding-3-small is located at index 9 (with 0 being the first index in the list of models)
1 point if gpt-3.5-turbo-1106 was created 16 models before gpt-3.5-turbo-0301
What is the correct total of points?</textarea>
                </div>
                <button id="fetchButton" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition duration-300 ease-in-out">
                    Analyze
                </button>
                <div class="mt-8">
                    <h2 class="text-xl font-semibold mb-4">Answer:</h2>
                    <div id="answerContainer" class="bg-gray-50 p-4 rounded-md"></div>
                </div>
            </div>
            
            <!-- Right Pane -->
            <div class="w-full md:w-1/2 bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">Models:</h2>
                <ul id="modelsContainer" class="list-disc pl-5 space-y-2 overflow-auto max-h-[600px]"></ul>
            </div>
        </div>
    </div>
	
    <script>
        document.getElementById('fetchButton').addEventListener('click', fetchModelsAndAnswer);

        async function fetchModelsAndAnswer() {
            const apiToken = document.getElementById('apiToken').value;
            const question = document.getElementById('question').value;
            const modelsContainer = document.getElementById('modelsContainer');
            const answerContainer = document.getElementById('answerContainer');

            if (!apiToken || !question) {
                alert('Please provide both API token and question.');
                return;
            }

            const modelsApiUrl = 'https://aiproxy.sanand.workers.dev/openai/v1/models';
            const chatApiUrl = 'https://aiproxy.sanand.workers.dev/openai/v1/chat/completions';

            try {
                // Fetch models
                const modelsResponse = await fetch(modelsApiUrl, {
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiToken}`
                    }
                });
                const modelsData = await modelsResponse.json();

                if (modelsData.data && Array.isArray(modelsData.data)) {
                    const modelsList = modelsData.data.map(model => `
                        <li class="text-gray-800">${model.id}</li>
                    `).join('');

                    modelsContainer.innerHTML = modelsList;
                } else {
                    modelsContainer.innerHTML = '<li class="text-red-500">No models data found in the response.</li>';
                }

                // Make chat completion request
                const chatResponse = await fetch(chatApiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiToken}`
                    },
                    body: JSON.stringify({
                        model: "gpt-3.5-turbo",
                        messages: [
                            {
                                role: "system",
                                content: "Analyze the json models response. Filter out models that were created before 15 May 2024. Sort the models as most recent first. Evaluate the following statements and calculate the total number of points according to instructions. Format of answer should be: points allocated for each point and total count. Do not show json in response. Only human readable content"
                            },
                            {
                                role: "user",
                                content: question
                            }
                        ]
                    })
                });
                const chatData = await chatResponse.json();

                if (chatData.choices && chatData.choices.length > 0) {
                    const answer = chatData.choices[0].message.content;
                    const formattedAnswer = formatAnswer(answer);
                    answerContainer.innerHTML = formattedAnswer;
                } else {
                    answerContainer.innerHTML = '<p class="text-red-500">No answer found in the response.</p>';
                }
            } catch (error) {
                console.error('Error:', error);
                modelsContainer.innerHTML = '<li class="text-red-500">An error occurred while fetching the data. Please check your API token and try again.</li>';
                answerContainer.innerHTML = '<p class="text-red-500">An error occurred while getting the answer. Please try again.</p>';
            }
        }

        function formatAnswer(answer) {
            const lines = answer.split('\n');
            let formattedAnswer = '';
            let inList = false;

            for (let line of lines) {
                line = line.trim();
                if (line.startsWith('- ') || line.startsWith('â€¢ ')) {
                    if (!inList) {
                        formattedAnswer += '<ul class="list-disc pl-5 space-y-2">';
                        inList = true;
                    }
                    formattedAnswer += `<li>${line.substring(2)}</li>`;
                } else {
                    if (inList) {
                        formattedAnswer += '</ul>';
                        inList = false;
                    }
                    formattedAnswer += `<p class="mb-2">${line}</p>`;
                }
            }

            if (inList) {
                formattedAnswer += '</ul>';
            }

            return formattedAnswer;
        }
    </script>
</body>
</html>
